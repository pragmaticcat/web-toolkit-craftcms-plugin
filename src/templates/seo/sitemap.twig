{% extends 'pragmatic-web-toolkit/seo/_layout' %}
{% import '_includes/forms' as forms %}

{% set title = 'Sitemap'|t('pragmatic-web-toolkit') %}
{% set selectedTab = 'sitemap' %}

{% set crumbs = [
  { label: 'SEO', url: url('pragmatic-toolkit/seo') },
  { label: 'Sitemap'|t('pragmatic-web-toolkit'), url: url('pragmatic-toolkit/seo/sitemap') },
] %}

{% block sidebar %}
  <nav aria-label="{{ 'Sections'|t('pragmatic-web-toolkit') }}">
    <ul class="nav">
      <li>
        <a class="{{ not sectionId ? 'sel' : '' }}" href="{{ url('pragmatic-toolkit/seo/sitemap', { site: selectedSite.handle }) }}">
          {{ 'All entries'|t('pragmatic-web-toolkit') }}
        </a>
      </li>
      {% if sections|length %}
        <li class="heading"><span>{{ 'Sections'|t('pragmatic-web-toolkit') }}</span></li>
        {% for section in sections %}
          <li>
            <a class="{{ section.id == sectionId ? 'sel' : '' }}" href="{{ url('pragmatic-toolkit/seo/sitemap', { site: selectedSite.handle, section: section.id }) }}">
              {{ section.name }} <span class="light" style="margin-left: 2px;">({{ section.count }})</span>
            </a>
          </li>
        {% endfor %}
      {% endif %}
    </ul>
  </nav>
{% endblock %}

{% block content %}
  <p>
    {{ 'Public sitemap URL:'|t('pragmatic-web-toolkit') }}
    <a href="{{ sitemapUrl }}" target="_blank" rel="noopener">{{ sitemapUrl }}</a>
  </p>

  {% if not canManageSitemap %}
    {% include 'pragmatic-web-toolkit/_partials/tier-lock' with {
      tier: 'pro',
      heading: 'Requires Pro version',
      message: 'Advanced sitemap management is available in Pro.'
    } %}
  {% endif %}

  {% if not canManageSitemap %}
    <p class="light">Upgrade to Pro to configure sitemap visibility and image inclusion per entry.</p>
  {% elseif rows is empty %}
    <p>{{ 'No entries with an SEO field in their layout.'|t('pragmatic-web-toolkit') }}</p>
  {% else %}
    <form method="post" accept-charset="UTF-8">
      {{ csrfInput() }}
      {{ actionInput('pragmatic-web-toolkit/seo/save-sitemap') }}
      {{ redirectInput('pragmatic-toolkit/seo/sitemap', { site: selectedSite.handle, section: sectionId }) }}
      <input type="hidden" name="site" value="{{ selectedSite.id }}">
      <fieldset {{ not canManageSitemap ? 'disabled' : '' }}>

      <table class="data fullwidth">
        <thead><tr><th>Entry</th><th>Visible in sitemap</th><th>Include images</th></tr></thead>
        <tbody>
        {% for rowIndex, row in rows %}
          <tr>
            <td>
              <input type="hidden" name="entries[{{ rowIndex }}][entryId]" value="{{ row.entry.id }}">
              <input type="hidden" name="entries[{{ rowIndex }}][fieldHandle]" value="{{ row.fieldHandle }}">
              {{ row.entry.title ?: ('Entry #' ~ row.entry.id) }}
            </td>
            <td>{{ forms.lightswitch({ name: "entries[#{rowIndex}][sitemapEnabled]", on: row.sitemapEnabled, value: 1 }) }}</td>
            <td>{{ forms.lightswitch({ name: "entries[#{rowIndex}][sitemapIncludeImages]", on: row.sitemapIncludeImages, value: 1 }) }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>

      <button type="submit" class="btn submit" style="margin-top:16px;">Save</button>
      </fieldset>
    </form>
  {% endif %}
{% endblock %}
