{% extends '_layouts/cp' %}

{% set title = title ?? 'Dashboard' %}
{% set selectedSubnavItem = 'dashboard' %}
{% set selectedTab = selectedTab ?? (craft.app.request.getSegment(4) ?? 'dashboard') %}
{% set _requestedSiteHandle = craft.app.request.getQueryParam('site') %}
{% set _tabParams = _requestedSiteHandle ? { site: _requestedSiteHandle } : {} %}

{% set tabs = {
  'dashboard': { label: 'Dashboard', url: url('pragmatic-toolkit/dashboard', _tabParams) },
  'configuration': { label: 'Configuration', url: url('pragmatic-toolkit/dashboard/configuration', _tabParams) },
  'plans': { label: 'Plans', url: url('pragmatic-toolkit/dashboard/plans', _tabParams) }
} %}

{% set _domainLabel = 'Dashboard'|t('pragmatic-web-toolkit') %}
{% set _domainUrl = url('pragmatic-toolkit/dashboard', _tabParams) %}
{% set _currentTab = tabs[selectedTab] ?? null %}
{% set crumbs = crumbs ?? [{ label: _domainLabel, url: _domainUrl }] %}
{% if _currentTab and _currentTab.url != _domainUrl %}
  {% set crumbs = crumbs|merge([{ label: _currentTab.label, url: _currentTab.url }]) %}
{% endif %}

{% set _allEditableSites = craft.app.sites.getEditableSites() %}
{% if _allEditableSites|length > 1 %}
  {% set _selectedSite = craft.app.sites.getPrimarySite() %}
  {% if _requestedSiteHandle %}
    {% set _siteByHandle = craft.app.sites.getSiteByHandle(_requestedSiteHandle) %}
    {% if _siteByHandle %}
      {% set _selectedSite = _siteByHandle %}
    {% endif %}
  {% endif %}
  {% if selectedSite is defined and selectedSite %}
    {% set _selectedSite = selectedSite %}
  {% endif %}
  {% set _siteMenuItems = siteMenuItems(_allEditableSites, _selectedSite) %}
  {% if _siteMenuItems|length %}
    {% set crumbs = crumbs|unshift({
      id: 'site-crumb',
      icon: 'world',
      iconAltText: 'Site'|t('app'),
      label: _selectedSite.name|t('site'),
      menu: {
        items: _siteMenuItems,
        label: 'Select site'|t('app')
      }
    }) %}
  {% endif %}
{% endif %}

{% block content %}{% endblock %}
